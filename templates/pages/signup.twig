{% extends 'base.twig' %}

{% block navigation %}
    {% include 'components/navigation.twig' with {'user': user, 'app_name': app_name} %}
{% endblock %}

{% block content %}
<div class="min-h-screen bg-black flex items-center justify-center p-4">
    <div class="w-full max-w-md">
        <div class="bg-gray-900 rounded-xl shadow-sm border border-gray-800 p-8">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-blue-500 rounded-lg mx-auto mb-4 flex items-center justify-center">
                    <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                        <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5z" clip-rule="evenodd"/>
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-white mb-2">Create Account</h2>
                <p class="text-gray-400">Start managing tickets today</p>
            </div>

            {% if _GET.error %}
                <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        showToast('{{ _GET.error }}', 'error');
                    });
                </script>
            {% endif %}

            <form id="signupForm" class="space-y-5">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-1.5">
                        Email address
                    </label>
                    <input 
                        type="email" 
                        name="email" 
                        id="email"
                        class="w-full px-3 py-2 rounded-lg border border-gray-700 bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                        placeholder="you@company.com"
                        required
                    />
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-1.5">
                        Password
                    </label>
                    <input 
                        type="password" 
                        name="password" 
                        id="password"
                        class="w-full px-3 py-2 rounded-lg border border-gray-700 bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                        placeholder="Create a password"
                        required
                    />
                    <p class="mt-1 text-sm text-gray-500">Must be at least 6 characters</p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-1.5">
                        Confirm Password
                    </label>
                    <input 
                        type="password" 
                        name="confirmPassword" 
                        id="confirmPassword"
                        class="w-full px-3 py-2 rounded-lg border border-gray-700 bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                        placeholder="Confirm your password"
                        required
                    />
                </div>

                <button type="submit" class="w-full bg-blue-500 text-white py-3 rounded-lg text-lg font-medium hover:bg-blue-600 transition">
                    Create Account
                </button>
            </form>

            <div class="mt-6 text-center">
                <a href="/login" class="text-sm text-blue-400 hover:text-blue-300 font-medium transition">
                    Already have an account? <span class="underline">Sign in</span>
                </a>
            </div>

            <div class="mt-4 text-center">
                <a href="/" class="text-sm text-gray-500 hover:text-gray-400 transition">
                    Back to Home
                </a>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const signupForm = document.getElementById('signupForm');
    
    if (signupForm) {
        signupForm.addEventListener('submit', handleSignup);
    }
});

function handleSignup(e) {
    e.preventDefault();
    
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirmPassword').value;

    // Client-side validation
    if (!email || !password || !confirmPassword) {
        showToast('Please fill in all fields', 'error');
        return;
    }

    if (!isValidEmail(email)) {
        showToast('Please enter a valid email address', 'error');
        return;
    }

    if (password.length < 6) {
        showToast('Password must be at least 6 characters', 'error');
        return;
    }

    if (password !== confirmPassword) {
        showToast('Passwords do not match', 'error');
        return;
    }

    // Show loading state
    const submitBtn = e.target.querySelector('button[type="submit"]');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Creating account...';
    submitBtn.disabled = true;

    // Simulate API call and show success toast
    setTimeout(() => {
        showToast('Account created successfully!', 'success');
        
        // Submit the form to PHP after showing toast
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/auth/signup';
        
        const emailInput = document.createElement('input');
        emailInput.type = 'hidden';
        emailInput.name = 'email';
        emailInput.value = email;
        
        const passwordInput = document.createElement('input');
        passwordInput.type = 'hidden';
        passwordInput.name = 'password';
        passwordInput.value = password;

        const confirmPasswordInput = document.createElement('input');
        confirmPasswordInput.type = 'hidden';
        confirmPasswordInput.name = 'confirmPassword';
        confirmPasswordInput.value = confirmPassword;
        
        form.appendChild(emailInput);
        form.appendChild(passwordInput);
        form.appendChild(confirmPasswordInput);
        document.body.appendChild(form);
        form.submit();
    }, 1500);
}

function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}
</script>
{% endblock %}